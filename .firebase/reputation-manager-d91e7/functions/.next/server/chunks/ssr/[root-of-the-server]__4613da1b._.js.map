{"version":3,"sources":["../../../../../../../Desktop/reputation-manager/reputation-manager/src/lib/services/survey-service.ts","../../../../../../../Desktop/reputation-manager/reputation-manager/src/app/actions/reports-actions.ts"],"sourcesContent":["import { db } from '../firebase';\nimport { collection, addDoc, query, where, getDocs, Timestamp, serverTimestamp } from 'firebase/firestore';\n\nexport interface SurveyRecord {\n    id: string;\n    propertyId: string;\n    residentEmail: string;\n    type: 'Move-In' | 'Move-Out';\n    status: 'SENT' | 'COMPLETED';\n    sentAt: any;\n    completedAt?: any;\n    rating?: number;\n    feedback?: string;\n}\n\nexport const SurveyService = {\n    /**\n     * Records a new survey being sent.\n     */\n    async recordSent(propertyId: string, residentEmail: string, type: 'Move-In' | 'Move-Out'): Promise<string> {\n        const docRef = await addDoc(collection(db, 'surveys'), {\n            propertyId,\n            residentEmail,\n            type,\n            status: 'SENT',\n            sentAt: serverTimestamp()\n        });\n        return docRef.id;\n    },\n\n    /**\n     * Updates a survey record when completed.\n     */\n    async recordCompletion(surveyId: string, rating: number, feedback: string): Promise<void> {\n        // In a real app, we'd use surveyId to find and update the doc.\n        // For simplicity here, we add a new \"completion\" or update status if ID is known.\n        // Logic for lookup omitted for brevity, adding a general record completion helper.\n        const surveysRef = collection(db, 'surveys');\n        // This is a simplification; usually you'd have a specific ID from the survey link.\n        await addDoc(surveysRef, {\n            surveyId, // Link original sent record\n            rating,\n            feedback,\n            status: 'COMPLETED',\n            completedAt: serverTimestamp()\n        });\n    },\n\n    /**\n     * Fetches survey analytics for a specific property and date range.\n     */\n    async getAnalytics(propertyId: string, startDate: Date, endDate: Date) {\n        const surveysRef = collection(db, 'surveys');\n        let q = query(surveysRef,\n            where('sentAt', '>=', Timestamp.fromDate(startDate)),\n            where('sentAt', '<=', Timestamp.fromDate(endDate))\n        );\n\n        if (propertyId !== 'ALL') {\n            q = query(q, where('propertyId', '==', propertyId));\n        }\n\n        const snapshot = await getDocs(q);\n        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n\n        return data;\n    }\n};\n","\"use server\";\n\nimport { SurveyService } from \"@/lib/services/survey-service\";\nimport { db } from \"@/lib/firebase\";\nimport { collection, addDoc, serverTimestamp } from \"firebase/firestore\";\n\nexport async function getSurveyAnalyticsAction(propertyId: string, startDateStr: string, endDateStr: string) {\n    try {\n        const start = new Date(startDateStr);\n        const end = new Date(endDateStr);\n        return await SurveyService.getAnalytics(propertyId, start, end);\n    } catch (error) {\n        console.error(\"Action error in getSurveyAnalyticsAction:\", error);\n        throw error;\n    }\n}\n\nexport async function scheduleReportAction(email: string, frequency: string, propertyId: string) {\n    try {\n        const schedulesRef = collection(db, 'report_schedules');\n        await addDoc(schedulesRef, {\n            email,\n            frequency,\n            propertyId,\n            createdAt: serverTimestamp(),\n            status: 'ACTIVE'\n        });\n        return { success: true };\n    } catch (error) {\n        console.error(\"Action error in scheduleReportAction:\", error);\n        throw error;\n    }\n}\n"],"names":[],"mappings":"mZAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAcO,IAAM,EAAgB,CAInB,WAAN,MAAiB,EAAoB,EAAuB,IAA4B,AAQ7E,CAPQ,CADgB,KACV,AADiC,AACjC,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAA,EAAE,CAAE,WAAY,YACnD,gBACA,OACA,EACA,OAAQ,OACR,OAAQ,CAAA,EAAA,EAAA,eAAe,AAAf,GACZ,EAAA,EACc,EAAE,CAMpB,MAAM,iBAAiB,CAAgB,CAAE,CAAc,CAAE,CAAgB,EAIrE,IAAM,EAAa,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAA,EAAE,CAAE,UAElC,OAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,EAAY,UACrB,SACA,WACA,EACA,OAAQ,YACR,YAAa,CAAA,EAAA,EAAA,eAAA,AAAe,GAChC,EACJ,EAKA,MAAM,aAAa,CAAkB,CAAE,CAAe,CAAE,CAAa,EACjE,IAAM,EAAa,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAA,EAAE,CAAE,WAC9B,EAAI,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,EACV,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,SAAU,KAAM,EAAA,SAAS,CAAC,QAAQ,CAAC,IACzC,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,SAAU,KAAM,EAAA,SAAS,CAAC,QAAQ,CAAC,KAU7C,MAPmB,CAOZ,MAPmB,CAAtB,IACA,EAAI,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,EAAG,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,aAAc,KAAM,GAAA,EAI9B,CADI,MAAM,CAAA,EAAA,EAAA,OAAO,AAAP,EAAQ,EAAA,EACT,IAAI,CAAC,GAAG,CAAC,IAAQ,CAAE,CAAH,EAAO,EAAI,EAAE,CAAE,GAAG,EAAI,IAAI,EAAE,CAAC,CAAC,CAGxE,CACJ,EC7DO,eAAe,EAAyB,CAAkB,CAAE,CAAoB,CAAE,CAAkB,EACvG,GAAI,CACA,IAAM,EAAQ,IAAI,KAAK,GACjB,EAAM,IAAI,KAAK,GACrB,OAAO,MAAM,EAAc,YAAY,CAAC,EAAY,EAAO,EAC/D,CAAE,MAAO,EAAO,CAEZ,MADA,QAAQ,KAAK,CAAC,4CAA6C,GACrD,CACV,CACJ,CAEO,eAAe,EAAqB,CAAa,CAAE,CAAiB,CAAE,CAAkB,EAC3F,GAAI,CACA,IAAM,EAAe,CAAA,EAAA,EAAA,UAAU,AAAV,EAAW,EAAA,EAAE,CAAE,oBAQpC,OAPA,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,EAAc,OACvB,YACA,EACA,aACA,UAAW,CAAA,EAAA,EAAA,eAAA,AAAe,IAC1B,OAAQ,QACZ,GACO,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAO,CAEZ,MADA,QAAQ,KAAK,CAAC,wCAAyC,GACjD,CACV,CACJ,0CA1BsB,EAWA,IAXA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAWA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}